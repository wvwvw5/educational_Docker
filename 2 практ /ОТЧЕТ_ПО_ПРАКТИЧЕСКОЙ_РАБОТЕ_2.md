# ОТЧЕТ ПО ПРАКТИЧЕСКОЙ РАБОТЕ №2
## "Развертывание приложений в Docker"

**Дисциплина:** Системы контейнеризации  
**Тема:** Docker - развертывание многокомпонентных приложений  
**Дата выполнения:** 8 сентября 2024 г.  
**Студент:** [ФИО студента]  
**Группа:** [Номер группы]  
**Преподаватель:** [ФИО преподавателя]  

---

## ОГЛАВЛЕНИЕ

1. [Цель и задачи работы](#цель-и-задачи-работы)
2. [Теоретические основы](#теоретические-основы)
3. [Анализ исходного приложения](#анализ-исходного-приложения)
4. [Создание Docker контейнеров](#создание-docker-контейнеров)
5. [Конфигурация Docker Compose](#конфигурация-docker-compose)
6. [Тестирование приложения](#тестирование-приложения)
7. [Результаты работы](#результаты-работы)
8. [Выводы и заключение](#выводы-и-заключение)
9. [Приложения](#приложения)

---

## ЦЕЛЬ И ЗАДАЧИ РАБОТЫ

### Цель работы:
Изучить процесс развертывания многокомпонентных приложений в Docker, освоить создание Docker Compose конфигураций и управление связанными сервисами.

### Задачи работы:
1. **Базовый уровень ("хорошо"):**
   - Запустить пример приложения time-db внутри контейнера Docker
   - Подробно пояснить каждую команду и компонент
   - Опубликовать готовый проект на GitHub

2. **Продвинутый уровень ("отлично"):**
   - Выполнить пункты базового уровня
   - Создать собственное приложение с минимум тремя компонентами
   - Оформить отчет с пояснениями каждого шага

---

## ТЕОРЕТИЧЕСКИЕ ОСНОВЫ

### Docker Compose

Docker Compose - это инструмент для определения и запуска многоконтейнерных приложений Docker. Основные преимущества:

- **Оркестрация сервисов** - управление несколькими контейнерами как единым приложением
- **Сетевое взаимодействие** - автоматическое создание сетей между контейнерами
- **Управление данными** - создание и монтирование томов
- **Переменные окружения** - конфигурация через environment variables

### Архитектура микросервисов

Современные приложения часто строятся по принципу микросервисов:
- **Frontend** - пользовательский интерфейс
- **Backend API** - бизнес-логика и обработка данных
- **База данных** - хранение данных
- **Административные инструменты** - управление системой

---

## АНАЛИЗ ИСХОДНОГО ПРИЛОЖЕНИЯ

### Структура приложения time-app-praktika

Исходное приложение состоит из двух основных компонентов:

#### 1. Backend API (Node.js + Express)
- **Файл**: `api/index.mjs`
- **Технологии**: Node.js, Express, MySQL2
- **Функциональность**:
  - GET `/` - проверка работы API
  - GET `/times` - получение всех сохраненных времен
  - POST `/times` - сохранение нового времени
  - DELETE `/time/:id` - удаление времени по ID

#### 2. Frontend (Vue.js)
- **Файл**: `frontend/src/components/Time.vue`
- **Технологии**: Vue.js 3, Vite, Moment.js
- **Функциональность**:
  - Отображение текущего времени в реальном времени
  - Сохранение времени в базу данных
  - Отображение ранее сохраненных времен
  - Удаление сохраненных времен

### Проблемы исходной конфигурации

1. **Хардкод портов** - API использует порт 5555, но должен использовать 5000
2. **Отсутствие контейнеризации** - приложение не готово для Docker
3. **Нет управления базой данных** - отсутствует инструмент для администрирования БД

---

## СОЗДАНИЕ DOCKER КОНТЕЙНЕРОВ

### 1. Dockerfile для API (Backend)

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

EXPOSE 5000

CMD ["npm", "start"]
```

**Объяснение команд:**
- `FROM node:18-alpine` - используем официальный образ Node.js 18 на базе Alpine Linux
- `WORKDIR /app` - устанавливаем рабочую директорию
- `COPY package*.json ./` - копируем файлы зависимостей
- `RUN npm install` - устанавливаем зависимости
- `COPY . .` - копируем исходный код
- `EXPOSE 5000` - открываем порт 5000
- `CMD ["npm", "start"]` - запускаем приложение

### 2. Dockerfile для Frontend (Multi-stage build)

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN npm run build

FROM nginx:alpine

COPY --from=0 /app/dist /usr/share/nginx/html

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

**Объяснение команд:**
- **Первый этап**: сборка Vue.js приложения
  - `FROM node:18-alpine` - образ для сборки
  - `RUN npm run build` - создание production сборки
- **Второй этап**: создание веб-сервера
  - `FROM nginx:alpine` - легковесный веб-сервер
  - `COPY --from=0` - копирование собранного приложения из первого этапа
  - `EXPOSE 80` - открытие порта для веб-сервера

### 3. Конфигурация базы данных

Обновлен файл `mysqlPool.mjs` для поддержки переменных окружения:

```javascript
const pool = mysql.createPool({
  connectionLimit: 100,
  host: process.env.MYSQL_HOST || 'mysql',
  port: process.env.MYSQL_PORT || '3306',
  user: process.env.MYSQL_USER || 'root',
  password: process.env.MYSQL_PASSWORD || 'password',
  database: process.env.MYSQL_DATABASE || 'time_db',
})
```

---

## КОНФИГУРАЦИЯ DOCKER COMPOSE

### docker-compose.yml

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: time-mysql
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: time_db
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - time-network

  api:
    build: ./api
    container_name: time-api
    ports:
      - "5000:5000"
    depends_on:
      - mysql
    environment:
      - NODE_ENV=production
    networks:
      - time-network

  frontend:
    build: ./frontend
    container_name: time-frontend
    ports:
      - "80:80"
    depends_on:
      - api
    networks:
      - time-network

  adminer:
    image: adminer:latest
    container_name: time-adminer
    ports:
      - "8080:8080"
    depends_on:
      - mysql
    networks:
      - time-network

volumes:
  mysql_data:

networks:
  time-network:
    driver: bridge
```

### Объяснение конфигурации

#### Сервисы:

1. **mysql** - База данных MySQL 8.0
   - `image: mysql:8.0` - официальный образ MySQL
   - `environment` - переменные окружения для настройки БД
   - `volumes` - постоянное хранение данных
   - `ports` - проброс порта 3306

2. **api** - Backend API
   - `build: ./api` - сборка из Dockerfile в папке api
   - `depends_on: mysql` - ожидание запуска MySQL
   - `ports` - проброс порта 5000

3. **frontend** - Frontend приложение
   - `build: ./frontend` - сборка из Dockerfile в папке frontend
   - `depends_on: api` - ожидание запуска API
   - `ports` - проброс порта 80

4. **adminer** - Административный интерфейс для БД
   - `image: adminer:latest` - готовый образ Adminer
   - `depends_on: mysql` - ожидание запуска MySQL
   - `ports` - проброс порта 8080

#### Сеть и тома:

- **time-network** - изолированная сеть для всех сервисов
- **mysql_data** - постоянный том для данных MySQL

---

## ТЕСТИРОВАНИЕ ПРИЛОЖЕНИЯ

### Команды для запуска

```bash
# Переход в директорию проекта
cd time-app-praktika

# Запуск всех сервисов
docker compose up --build

# Запуск в фоновом режиме
docker compose up -d --build
```

### Проверка работы сервисов

```bash
# Просмотр запущенных контейнеров
docker ps

# Просмотр логов
docker compose logs

# Проверка API
curl http://localhost:5000/

# Проверка фронтенда
curl http://localhost/
```

### Доступ к приложению

- **Веб-приложение**: http://localhost
- **API**: http://localhost:5001
- **Adminer**: http://localhost:8080
  - Сервер: `mysql`
  - Пользователь: `root`
  - Пароль: `password`
  - База данных: `time_db`

---

## РЕЗУЛЬТАТЫ РАБОТЫ

### Успешно выполнено:

✅ **Создано 4 Docker контейнера**:
- MySQL 8.0 (база данных)
- Node.js API (backend)
- Vue.js Frontend (frontend)
- Adminer (администрирование БД)

✅ **Настроена сетевая связность** между всеми сервисами

✅ **Создана Docker Compose конфигурация** для оркестрации

✅ **Добавлена поддержка переменных окружения**

✅ **Настроено постоянное хранение данных** для MySQL

### Архитектура приложения:

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Backend API   │    │   MySQL DB      │
│   (Vue.js)      │◄──►│   (Node.js)     │◄──►│   (MySQL 8.0)   │
│   Port: 80      │    │   Port: 5000    │    │   Port: 3306    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   Adminer       │
                    │   Port: 8080    │
                    └─────────────────┘
```

### Размеры образов:

| Сервис | Размер образа | Описание |
|--------|---------------|----------|
| MySQL | ~500 MB | База данных с данными |
| API | ~200 MB | Node.js + зависимости |
| Frontend | ~50 MB | Nginx + собранное приложение |
| Adminer | ~100 MB | Веб-интерфейс для БД |

---

## ВЫВОДЫ И ЗАКЛЮЧЕНИЕ

### Достигнутые результаты:

1. **Освоена контейнеризация многокомпонентных приложений**
2. **Изучена работа с Docker Compose** для оркестрации сервисов
3. **Настроено сетевое взаимодействие** между контейнерами
4. **Реализовано управление данными** через Docker volumes
5. **Добавлен административный интерфейс** для управления БД

### Преимущества Docker Compose:

- **Упрощение развертывания** - одна команда для запуска всего приложения
- **Изоляция сервисов** - каждый компонент работает в своем контейнере
- **Масштабируемость** - легко добавлять новые сервисы
- **Воспроизводимость** - одинаковое поведение на всех средах

### Полученные навыки:

- Создание Dockerfile для различных типов приложений
- Настройка Docker Compose для многоконтейнерных приложений
- Управление сетевым взаимодействием между контейнерами
- Работа с Docker volumes для постоянного хранения данных
- Использование переменных окружения для конфигурации

### Практическая значимость:

Полученные знания позволяют эффективно развертывать сложные приложения в контейнерах, что является стандартом в современной разработке и DevOps практиках. Docker Compose значительно упрощает управление микросервисной архитектурой.

---

## ПРИЛОЖЕНИЯ

### Приложение А. Структура проекта

```
time-app-praktika/
├── api/                    # Backend API
│   ├── src/
│   │   └── utils/
│   │       ├── mysqlPool.mjs
│   │       └── records.mjs
│   ├── Dockerfile
│   ├── .dockerignore
│   ├── package.json
│   └── index.mjs
├── frontend/               # Frontend приложение
│   ├── src/
│   │   ├── components/
│   │   │   └── Time.vue
│   │   ├── utils/
│   │   │   └── time.js
│   │   ├── assets/
│   │   └── main.js
│   ├── Dockerfile
│   ├── .dockerignore
│   ├── package.json
│   ├── vite.config.js
│   └── index.html
├── docker-compose.yml      # Конфигурация всех сервисов
└── README.md
```

### Приложение Б. Полезные команды

```bash
# Управление сервисами
docker compose up -d          # Запуск в фоне
docker compose down           # Остановка
docker compose restart        # Перезапуск
docker compose logs -f        # Просмотр логов

# Управление образами
docker compose build          # Пересборка образов
docker compose pull           # Обновление образов
docker system prune -a        # Очистка системы

# Отладка
docker compose exec api bash  # Подключение к API
docker compose exec mysql mysql -u root -p  # Подключение к БД
docker inspect time-api       # Информация о контейнере
```

### Приложение В. API Endpoints

| Метод | Endpoint | Описание | Пример ответа |
|-------|----------|----------|---------------|
| GET | `/` | Проверка работы API | "Hello from the time saving service!" |
| GET | `/times` | Получить все времена | `[{"id":1,"time":"14:30:25","created_at":"2024-09-08T14:30:25.000Z"}]` |
| POST | `/times` | Сохранить время | `{"insertId":1}` |
| DELETE | `/time/:id` | Удалить время | `{"affectedRows":1}` |

### Приложение Г. Переменные окружения

| Переменная | Описание | Значение по умолчанию |
|------------|----------|----------------------|
| `MYSQL_HOST` | Хост MySQL | `mysql` |
| `MYSQL_PORT` | Порт MySQL | `3306` |
| `MYSQL_USER` | Пользователь MySQL | `root` |
| `MYSQL_PASSWORD` | Пароль MySQL | `password` |
| `MYSQL_DATABASE` | Имя базы данных | `time_db` |
| `NODE_ENV` | Режим Node.js | `production` |

---

**Подпись студента:** _________________  
**Дата:** 8 сентября 2024 г.  

**Подпись преподавателя:** _________________  
**Оценка:** ________  
**Дата проверки:** ________
